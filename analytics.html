<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AnomCAT">
    <meta name="theme-color" content="#0d0d0f">
    <meta name="description" content="AnomCAT - Analytics Dashboard">
    
    <title>Analytics | AnomCAT</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%233b82f6'/%3E%3Ctext x='50' y='65' font-size='50' text-anchor='middle' fill='white'%3EA%3C/text%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%233b82f6'/%3E%3Ctext x='50' y='65' font-size='50' text-anchor='middle' fill='white'%3EA%3C/text%3E%3C/svg%3E">
    
    <link rel="stylesheet" href="assets/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="app">
        <!-- Top Navigation Bar -->
        <header class="top-bar">
            <div class="top-bar-left">
                <a href="home.html" class="logo">
                    <div class="logo-icon">A</div>
                    <span>AnomCAT</span>
                </a>
            </div>
            <div class="top-bar-right">
                <div class="currency-toggle">
                    <button class="currency-btn active" data-currency="BTC">BTC</button>
                    <button class="currency-btn" data-currency="EUR">EUR</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Page Header -->
            <div class="page-header">
                <h1 class="page-title">Analytics</h1>
                <p class="page-subtitle">Performance metrics and insights</p>
            </div>

            <!-- Performance Overview -->
            <div class="card analytics-card">
                <div class="card-header">
                    <h3 class="card-title">Total Profit</h3>
                    <span class="stat-change positive" data-stat="roi">+0.00%</span>
                </div>
                <div class="analytics-value" data-stat="profit">+0.00000000 BTC</div>
                <div class="analytics-label" data-balance="secondary">â‚¬0.00 equivalent</div>
                
                <!-- Profit Chart -->
                <div class="analytics-chart">
                    <canvas id="profitChart"></canvas>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="stat-grid mb-6">
                <div class="stat-item">
                    <div class="stat-label">Total Trades</div>
                    <div class="stat-value" data-stat="trades">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Win Rate</div>
                    <div class="stat-value" data-stat="winrate">--</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Avg. Trade Size</div>
                    <div class="stat-value" id="avgTradeSize">--</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Bot Uptime</div>
                    <div class="stat-value" id="botUptime">--</div>
                </div>
            </div>

            <!-- Monthly Performance -->
            <div class="card analytics-card">
                <div class="card-header">
                    <h3 class="card-title">Monthly Performance</h3>
                </div>
                <div class="chart-container" style="height: 220px;">
                    <canvas id="monthlyChart"></canvas>
                </div>
            </div>

            <!-- Trading Activity -->
            <div class="card analytics-card">
                <div class="card-header">
                    <h3 class="card-title">Trading Activity</h3>
                </div>
                <div class="chart-container" style="height: 180px;">
                    <canvas id="activityChart"></canvas>
                </div>
            </div>

            <!-- Performance Summary -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Summary</h3>
                </div>
                <div class="settings-list" style="border: none; background: transparent;">
                    <div class="settings-item" style="cursor: default;">
                        <div class="settings-item-left">
                            <div class="settings-item-icon" style="background: rgba(16, 185, 129, 0.15); color: #10b981;">ðŸ“ˆ</div>
                            <div class="settings-item-content">
                                <span class="settings-item-title">Expected Monthly Return</span>
                                <span class="settings-item-subtitle">Based on CAT Bot strategy</span>
                            </div>
                        </div>
                        <div class="settings-item-right">
                            <span class="text-success" style="font-weight: 600;">+1.3%</span>
                        </div>
                    </div>
                    <div class="settings-item" style="cursor: default;">
                        <div class="settings-item-left">
                            <div class="settings-item-icon" style="background: rgba(59, 130, 246, 0.15); color: #3b82f6;">ðŸŽ¯</div>
                            <div class="settings-item-content">
                                <span class="settings-item-title">Strategy</span>
                                <span class="settings-item-subtitle">Automated trading algorithm</span>
                            </div>
                        </div>
                        <div class="settings-item-right">
                            <span style="font-weight: 600;">Momentum + Mean Reversion</span>
                        </div>
                    </div>
                    <div class="settings-item" style="cursor: default;">
                        <div class="settings-item-left">
                            <div class="settings-item-icon" style="background: rgba(245, 158, 11, 0.15); color: #f59e0b;">âš¡</div>
                            <div class="settings-item-content">
                                <span class="settings-item-title">Trading Frequency</span>
                                <span class="settings-item-subtitle">Average trades per day</span>
                            </div>
                        </div>
                        <div class="settings-item-right">
                            <span style="font-weight: 600;" id="tradingFrequency">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <a href="home.html" class="nav-item">
                <div class="nav-icon">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                    </svg>
                </div>
                <span class="nav-label">Home</span>
            </a>
            <a href="wallet.html" class="nav-item">
                <div class="nav-icon">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
                    </svg>
                </div>
                <span class="nav-label">Wallet</span>
            </a>
            <a href="transactions.html" class="nav-item">
                <div class="nav-icon">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/>
                    </svg>
                </div>
                <span class="nav-label">Activity</span>
            </a>
            <a href="analytics.html" class="nav-item active">
                <div class="nav-icon">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                    </svg>
                </div>
                <span class="nav-label">Analytics</span>
            </a>
            <a href="settings.html" class="nav-item">
                <div class="nav-icon">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
                    </svg>
                </div>
                <span class="nav-label">Settings</span>
            </a>
        </nav>
    </div>

    <script src="assets/js/app.js"></script>
    <script>
        let profitChart = null;
        let monthlyChart = null;
        let activityChart = null;
        
        function initCharts() {
            initProfitChart();
            initMonthlyChart();
            initActivityChart();
            updateAnalytics();
        }
        
        function initProfitChart() {
            const ctx = document.getElementById('profitChart').getContext('2d');
            const chartData = AnomCAT.generateChartData(30);
            
            const gradient = ctx.createLinearGradient(0, 0, 0, 180);
            gradient.addColorStop(0, 'rgba(16, 185, 129, 0.3)');
            gradient.addColorStop(1, 'rgba(16, 185, 129, 0)');
            
            profitChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.map(d => ''),
                    datasets: [{
                        data: chartData.map(d => d.value),
                        borderColor: '#10b981',
                        backgroundColor: gradient,
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { enabled: false } },
                    scales: { x: { display: false }, y: { display: false } }
                }
            });
        }
        
        function initMonthlyChart() {
            const ctx = document.getElementById('monthlyChart').getContext('2d');
            
            // Try to use JSON data first
            const monthlyData = AnomCAT.getMonthlyPerformance();
            let displayMonths, data;
            
            if (monthlyData && monthlyData.length > 0) {
                displayMonths = monthlyData.map(m => m.month);
                data = monthlyData.map(m => m.return);
            } else {
                // Generate fallback monthly data
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                const currentMonth = new Date().getMonth();
                displayMonths = [];
                data = [];
                
                for (let i = 5; i >= 0; i--) {
                    const monthIndex = (currentMonth - i + 12) % 12;
                    displayMonths.push(months[monthIndex]);
                    data.push((1.3 + (Math.random() - 0.5) * 0.6).toFixed(2));
                }
            }
            
            monthlyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: displayMonths,
                    datasets: [{
                        data: data,
                        backgroundColor: data.map(v => parseFloat(v) >= 0 ? 'rgba(16, 185, 129, 0.8)' : 'rgba(239, 68, 68, 0.8)'),
                        borderRadius: 4,
                        barPercentage: 0.6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#1e1e21',
                            titleColor: '#f5f5f7',
                            bodyColor: '#a1a1aa',
                            borderColor: '#27272a',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return context.raw + '% return';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { color: '#71717a', font: { size: 11 } }
                        },
                        y: {
                            grid: { color: '#27272a', drawBorder: false },
                            ticks: {
                                color: '#71717a',
                                font: { size: 11 },
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function initActivityChart() {
            const ctx = document.getElementById('activityChart').getContext('2d');
            
            // Try to use JSON data first
            const activityData = AnomCAT.getTradingActivity();
            let displayDays, data;
            
            if (activityData && activityData.length > 0) {
                displayDays = activityData.map(d => d.day);
                data = activityData.map(d => d.trades);
            } else {
                // Generate fallback activity data
                const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                const today = new Date().getDay();
                displayDays = [];
                data = [];
                
                for (let i = 6; i >= 0; i--) {
                    const dayIndex = (today - i + 7) % 7;
                    displayDays.push(days[dayIndex]);
                    data.push(Math.floor(Math.random() * 15) + 5);
                }
            }
            
            activityChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: displayDays,
                    datasets: [{
                        data: data,
                        backgroundColor: 'rgba(59, 130, 246, 0.8)',
                        borderRadius: 4,
                        barPercentage: 0.5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#1e1e21',
                            titleColor: '#f5f5f7',
                            bodyColor: '#a1a1aa',
                            borderColor: '#27272a',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return context.raw + ' trades';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { color: '#71717a', font: { size: 11 } }
                        },
                        y: {
                            grid: { color: '#27272a', drawBorder: false },
                            ticks: { color: '#71717a', font: { size: 11 } }
                        }
                    }
                }
            });
        }
        
        function updateAnalytics() {
            const trades = AnomCAT.portfolio.trades;
            
            // Average trade size
            if (trades.length > 0) {
                const avg = trades.reduce((sum, t) => sum + t.amount, 0) / trades.length;
                document.getElementById('avgTradeSize').textContent = AnomCAT.formatCurrency(avg);
            }
            
            // Bot uptime
            if (AnomCAT.bot.active) {
                const uptime = Date.now() - (AnomCAT.portfolio.history[0]?.time || Date.now());
                const days = Math.floor(uptime / (1000 * 60 * 60 * 24));
                const hours = Math.floor((uptime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                document.getElementById('botUptime').textContent = days > 0 ? `${days}d ${hours}h` : `${hours}h`;
            }
            
            // Trading frequency
            if (trades.length > 0) {
                const firstTrade = trades[trades.length - 1];
                const daysSinceFirst = (Date.now() - firstTrade.time) / (1000 * 60 * 60 * 24);
                const frequency = daysSinceFirst > 0 ? (trades.length / daysSinceFirst).toFixed(1) : trades.length;
                document.getElementById('tradingFrequency').textContent = frequency + '/day';
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', initCharts);
        
        // Listen for currency changes
        window.addEventListener('currencyChanged', function() {
            updateAnalytics();
            
            if (profitChart) {
                const chartData = AnomCAT.generateChartData(30);
                profitChart.data.datasets[0].data = chartData.map(d => d.value);
                profitChart.update('none');
            }
        });
    </script>
</body>
</html>
